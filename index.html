<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Telegram Web App Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Подключение Telegram Web App JS (они будут доступны внутри клиента Telegram) -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="newindex.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap" rel="stylesheet">
    
</head>
<body>
    
    <details id="search-spoiler">
        
        <p> Статусы СЗ </p>
        <p> Поиск </p>
        
        <summary> <div class="arrow arrow-bottom"></div> </summary>
    </details>

    <div id="item-list">

        <div class="sz-card" data-sz-id="1">
            <div class="action-plate blue">УДАЛИТЬ</div>
            <div class="action-plate red">АРХИВ</div>
            <div class="textpart">
                <div class="topline">
                    <h3>СЗ № X/Y-YY/ZZZZ-gen</h3>
                </div>
                <div class="bottomline">
                    <div class="circle"></div>
                    <p class="company-name">ООО "Новороссийский припортовый терминал"</p>
                </div>
            </div> 

            <div class="digital-part">
                <div class="topline">
                    <p class="date">2111.11.11</p>
                </div>
                <div class="bottomline">
                    <p class="summary">1.11 млн ₽</span></p>
                </div>
            </div>
        </div>
        
        <div class="sz-separator">
        </div>

        <div class="sz-card" data-sz-id="2">
            <div class="action-plate blue">УДАЛИТЬ</div>
            <div class="action-plate red">АРХИВ</div>
            <div class="textpart">
                <div class="topline">
                    <h3>СЗ № A/B-CC/DDDD-gen</h3>
                </div>
                <div class="bottomline">
                    <div class="circle"></div>
                    <p class="company-name">ООО "Другая компания"</p>
                </div>
            </div> 

            <div class="digital-part">
                <div class="topline">
                    <p class="date">2024.01.15</p>
                </div>
                <div class="bottomline">
                    <p class="summary">2.5 млн ₽</span></p>
                </div>
            </div>
        </div>
        
        <div class="sz-separator">
        </div>

        <style>
            p{
                margin: 0;
            }
            .sz-card {
                width: 100%;
                height: 89px;
                background-color: var(--tg-theme-bg-color);
                display: flex;
                position: relative;
                transition: transform 0.3s ease;
                cursor: grab;
                user-select: none;
                touch-action: pan-y;
            }
            .sz-card:active {
                cursor: grabbing;
            }
            .sz-card.swiping {
                transition: none;
            }
            .textpart {
                flex: 0 0 80%;
                max-width: 80%;
            }
            .textpart .topline {
                padding-left: 10px;
            }
            .textpart .bottomline {
                padding-left: 10px;
            }
            .textpart h3 {
                font-size: 18px;
                margin: 0;
            }
            .circle {
                width: 12px;
                height: 12px;
                border-radius: 50%;
                background: #000;
                display: inline-block;
                margin-right: 3px;
            }
            .textpart p {
                 font-size: 14px;
             }
             .company-name {
                 white-space: nowrap;
                 overflow: hidden;
                 text-overflow: ellipsis;
             }
            .digital-part {
                flex: 0 0 20%;
                max-width: 20%;
                font-size: 12px;
            }
            .topline {
                 height: 50%;
                 display: flex;
                 align-items: center;
             }
             .bottomline {
                 height: 50%;
                 display: flex;
                 align-items: center;
             }
            .date {
                width: 100%;
                text-align: center;
            }
            .summary {
                width: 100%;
                text-align: center;
            }

            .sz-separator {
                height: 1px;
                width: 100%;
                background-color: var(--tg-theme-section-separator-color);
                padding-left: 40px;
            }

            .action-plate {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                display: flex;
                align-items: center;
                justify-content: center;
                color: white;
                font-weight: bold;
                font-size: 16px;
                z-index: 1;
                opacity: 0;
                transition: opacity 0.3s ease;
            }

            .action-plate.blue {
                background-color: #2196F3;
            }

            .action-plate.red {
                background-color: #F44336;
            }

            .action-plate.show {
                opacity: 1;
            }

            .sz-card {
                width: 100%;
                height: 89px;
                background-color: var(--tg-theme-bg-color);
                display: flex;
                position: relative;
                transition: transform 0.3s ease;
                cursor: grab;
                user-select: none;
                touch-action: pan-y;
                overflow: hidden;
            }
        </style>
        
    </div>

    <script>
        // Класс для управления свайпами
        class SwipeManager {
            constructor() {
                this.startX = 0;
                this.startY = 0;
                this.currentX = 0;
                this.currentY = 0;
                this.isSwiping = false;
                this.swipeThreshold = 100; // Дистанция свайпа 100px
                this.currentCard = null;
                
                this.init();
            }
            
            init() {
                // Находим все карточки
                const cards = document.querySelectorAll('.sz-card');
                
                cards.forEach(card => {
                    // События для мыши
                    card.addEventListener('mousedown', (e) => this.handleStart(e, card));
                    card.addEventListener('mousemove', (e) => this.handleMove(e));
                    card.addEventListener('mouseup', (e) => this.handleEnd(e));
                    card.addEventListener('mouseleave', (e) => this.handleEnd(e));
                    
                    // События для касаний
                    card.addEventListener('touchstart', (e) => this.handleStart(e, card));
                    card.addEventListener('touchmove', (e) => this.handleMove(e));
                    card.addEventListener('touchend', (e) => this.handleEnd(e));
                    
                    // Предотвращаем контекстное меню
                    card.addEventListener('contextmenu', (e) => e.preventDefault());
                });
            }
            
            handleStart(e, card) {
                e.preventDefault();
                
                this.currentCard = card;
                this.isSwiping = true;
                card.classList.add('swiping');
                
                // Получаем начальные координаты
                if (e.type === 'touchstart') {
                    this.startX = e.touches[0].clientX;
                    this.startY = e.touches[0].clientY;
                } else {
                    this.startX = e.clientX;
                    this.startY = e.clientY;
                }
                
                this.currentX = this.startX;
                this.currentY = this.startY;
            }
            
            handleMove(e) {
                if (!this.isSwiping || !this.currentCard) return;
                
                e.preventDefault();
                
                // Получаем текущие координаты
                if (e.type === 'touchmove') {
                    this.currentX = e.touches[0].clientX;
                    this.currentY = e.touches[0].clientY;
                } else {
                    this.currentX = e.clientX;
                    this.currentY = e.clientY;
                }
                
                // Вычисляем смещение
                const deltaX = this.currentX - this.startX;
                const deltaY = this.currentY - this.startY;
                
                // Проверяем, что движение больше горизонтальное, чем вертикальное
                if (Math.abs(deltaX) > Math.abs(deltaY)) {
                    // Применяем трансформацию для визуальной обратной связи
                    const transformX = Math.max(-50, Math.min(50, deltaX * 0.3));
                    this.currentCard.style.transform = `translateX(${transformX}px)`;
                    
                    // Показываем соответствующую плашку
                    const bluePlate = this.currentCard.querySelector('.action-plate.blue');
                    const redPlate = this.currentCard.querySelector('.action-plate.red');
                    
                    if (deltaX < -20) {
                        // Свайп влево - показываем синюю плашку
                        if (bluePlate) bluePlate.classList.add('show');
                        if (redPlate) redPlate.classList.remove('show');
                    } else if (deltaX > 20) {
                        // Свайп вправо - показываем красную плашку
                        if (redPlate) redPlate.classList.add('show');
                        if (bluePlate) bluePlate.classList.remove('show');
                    } else {
                        // Скрываем обе плашки
                        if (bluePlate) bluePlate.classList.remove('show');
                        if (redPlate) redPlate.classList.remove('show');
                    }
                }
            }
            
            handleEnd(e) {
                if (!this.isSwiping || !this.currentCard) return;
                
                e.preventDefault();
                
                // Вычисляем финальное смещение
                const deltaX = this.currentX - this.startX;
                const deltaY = this.currentY - this.startY;
                
                // Скрываем все плашки
                const bluePlate = this.currentCard.querySelector('.action-plate.blue');
                const redPlate = this.currentCard.querySelector('.action-plate.red');
                if (bluePlate) bluePlate.classList.remove('show');
                if (redPlate) redPlate.classList.remove('show');
                
                // Сбрасываем трансформацию
                this.currentCard.style.transform = '';
                this.currentCard.classList.remove('swiping');
                
                // Проверяем условия для свайпа
                if (Math.abs(deltaX) >= this.swipeThreshold && Math.abs(deltaX) > Math.abs(deltaY)) {
                    // Определяем направление свайпа
                    if (deltaX > 0) {
                        this.handleSwipeRight(this.currentCard);
                    } else {
                        this.handleSwipeLeft(this.currentCard);
                    }
                }
                
                // Сбрасываем состояние
                this.isSwiping = false;
                this.currentCard = null;
            }
            
            handleSwipeLeft(card) {
                const szId = card.getAttribute('data-sz-id');
                console.log(`Свайп влево для СЗ ${szId}`);
                
                // Показываем синюю плашку на полную видимость
                const bluePlate = card.querySelector('.action-plate.blue');
                if (bluePlate) {
                    bluePlate.classList.add('show');
                }
                
                // Анимация удаления
                card.style.transform = 'translateX(-100%)';
                card.style.opacity = '0';
                setTimeout(() => {
                    //card.remove();
                    // Удаляем следующий разделитель, если он есть
                    //const nextSeparator = card.nextElementSibling;
                    if (nextSeparator && nextSeparator.classList.contains('sz-separator')) {
                        nextSeparator.remove();
                    }
                }, 300);
            }
            
            handleSwipeRight(card) {
                const szId = card.getAttribute('data-sz-id');
                console.log(`Свайп вправо для СЗ ${szId}`);
                
                // Показываем красную плашку на полную видимость
                const redPlate = card.querySelector('.action-plate.red');
                if (redPlate) {
                    redPlate.classList.add('show');
                }
                
                // Пример: изменение цвета кружка
                const circle = card.querySelector('.circle');
                if (circle) {
                    circle.style.background = '#4CAF50';
                    setTimeout(() => {
                        circle.style.background = '#000';
                    }, 1000);
                }
            }
        }
        
        // Инициализируем менеджер свайпов после загрузки DOM
        document.addEventListener('DOMContentLoaded', () => {
            new SwipeManager();
        });
    </script>

    <!--
    <script src="/general.js"></script>
    <script src="/main.js"></script>
    -->

</body>
</html>